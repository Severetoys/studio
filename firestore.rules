
rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // Allow admin full access to content collections
    match /products/{productId} {
      allow read, write: if request.auth != null && request.auth.uid == 'YOUR_ADMIN_UID';
    }
    match /photos/{photoId} {
      allow read, write: if request.auth != null && request.auth.uid == 'YOUR_ADMIN_UID';
    }
    match /videos/{videoId} {
      allow read, write: if request.auth != null && request.auth.uid == 'YOUR_ADMIN_UID';
    }

    // Rules for the Secret Chat
    match /chats/{chatId} {
      // Anyone (anonymous users) can create their own chat document.
      // Admin can read any chat document.
      allow read, create: if request.auth != null;
      allow update: if request.auth != null && (request.auth.token.isAnonymous == true || request.auth.uid == 'YOUR_ADMIN_UID');

      match /messages/{messageId} {
        // Anyone can read messages in any chat.
        // Anyone can write a message to their own chat.
        // Admin can write to any chat.
        allow read, create: if request.auth != null;
      }
    }
    
    // Default deny all other collections
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
